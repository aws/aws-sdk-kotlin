# Custom SDK build Gradle plugin

This document outlines an idea for a Gradle plugin in the AWS SDK for Kotlin to provide custom-built dependencies with
a subset of operations and data types.

## Problem statement

Presently, users of the AWS SDK for Kotlin add service client dependencies to their project by referencing pre-built
Maven dependencies which are published by AWS. These service clients contain every operation a service supports along
with every data type required by those operations. This is simple and straightforward and works for many common use
cases. These pre-built dependencies can be quite large and that may pose challenges for mobile, serverless, or other
environments where binary size and startup times are closely scrutinized and should be minimized. Most users of a
particular service client do not need all operations it supports. Often users invoke a dozen or so operations out of
hundreds. The uninvoked operations and their required data types bloat the size of users' dependencies unnecessarily.

## Proposal

We should create a Gradle plugin that allows users to specify precisely which services and operations they want to use.
The plugin will code-generate service clients and required data types during a Gradle build of a user's project. Users'
runtime code may then utilize the service clients as drop-in replacements for the pre-built SDK clients which contain
every operation.

### Example usage

As an example, a user may replace their dependencies on pre-built clients:

```kotlin
// build.gradle.kts

dependencies {
    implementation("aws.sdk.kotlin:s3:1.2.3")
    implementation("aws.sdk.kotlin:dynamodb:1.2.3")
}
```

With the new Gradle plugin and DSL configuration:

```kotlin
// build.gradle.kts

plugins {
    id("aws.sdk.kotlin.custom-sdk-build")
}

val sdkDependency = awsCustomSdkBuild {
    s3 {
        operations(GetObject, PutObject)
    }
    
    dynamodb {
        operations(PutItem, GetItem)
    }
}

dependencies {
    implementation(sdkDependency)
}
```

## Requirements

These are the requirements for the plugin:

* The plugin **MUST** be a published component of the AWS SDK for Kotlin
* The plugin version **MUST** match the overall SDK runtime version
* The plugin **MUST** provide DSL methods for each modeled service
* The plugin **MUST** provide named constants for each modeled operation in a service
* The service methods and operation constants **MUST** be code-generated by Smithy codegen at plugin build time
* The plugin **MUST** allow customizing the package namespace for generated code (defaults to `aws.sdk.kotlin.services`)
* The plugin **MUST** allow customizing the output directory for generated code
* The plugin **MUST** use Smithy codegen to generate the custom clients during a Gradle build of user code
* The plugin **MUST** apply the `awsSmithyKotlinIncludeOperations` Smithy transformer to the Smithy projection to limit
  the codegen to the operations selected by the user
* The plugin **MUST** use the same models used for the pre-built service clients in the same release. For example,
  plugin version 1.2.3 will know about and build clients based on the Smithy models in SDK release 1.2.3.
